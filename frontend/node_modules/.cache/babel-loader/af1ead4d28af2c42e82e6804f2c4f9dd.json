{"ast":null,"code":"import _asyncToGenerator from\"/Users/davidbroida/Desktop/MusicMatch2/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/davidbroida/Desktop/MusicMatch2/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/davidbroida/Desktop/MusicMatch2/frontend/node_modules/@babel/runtime/regenerator/index.js\";import React,{useState,useEffect}from'react';import{BrowserRouter}from'react-router-dom';import NavBar from'./components/NavBar';import Routes from'./components/Routes';import'bootstrap/dist/css/bootstrap.min.css';import useLocalStorage from'./hooks/useLocalStorage';import MusicMatchApi from'./api/api';import jwt_decode from'jwt-decode';import UserContext from'./auth/UserContext';// import jwt from 'jsonwebtoken';\nimport'./App.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var TOKEN_STORAGE_ID=\"music_match-token\";function App(){var _useLocalStorage=useLocalStorage(TOKEN_STORAGE_ID),_useLocalStorage2=_slicedToArray(_useLocalStorage,2),token=_useLocalStorage2[0],setToken=_useLocalStorage2[1];var _useState=useState(null),_useState2=_slicedToArray(_useState,2),currentUser=_useState2[0],setCurrentUser=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),infoLoaded=_useState4[0],setInfoLoaded=_useState4[1];useEffect(function loadUserInfo(){function getCurrentUser(){return _getCurrentUser.apply(this,arguments);}function _getCurrentUser(){_getCurrentUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _jwt_decode,username,_currentUser;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!token){_context.next=14;break;}_context.prev=1;_jwt_decode=jwt_decode(token),username=_jwt_decode.username;MusicMatchApi.token=token;_context.next=6;return MusicMatchApi.getCurrentUser(username);case 6:_currentUser=_context.sent;setCurrentUser(_currentUser);_context.next=14;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](1);console.error('App function loadUserInfo encountered a problem loading the user.',_context.t0);setCurrentUser(null);case 14:setInfoLoaded(true);case 15:case\"end\":return _context.stop();}}},_callee,null,[[1,10]]);}));return _getCurrentUser.apply(this,arguments);}setInfoLoaded(false);getCurrentUser();},[token]);function signup(_x){return _signup.apply(this,arguments);}function _signup(){_signup=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(signupData){var _token;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return MusicMatchApi.signup(signupData);case 3:_token=_context2.sent;setToken(_token);return _context2.abrupt(\"return\",{success:true});case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);console.error('signup failed',_context2.t0);return _context2.abrupt(\"return\",{succes:false,errors:_context2.t0});case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8]]);}));return _signup.apply(this,arguments);}function login(_x2){return _login.apply(this,arguments);}function _login(){_login=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(loginData){var _token2;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return MusicMatchApi.login(loginData);case 3:_token2=_context3.sent;setToken(_token2);return _context3.abrupt(\"return\",{success:true});case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);console.error('login failed',_context3.t0);return _context3.abrupt(\"return\",{success:false,errors:_context3.t0});case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);}));return _login.apply(this,arguments);}function logout(){setCurrentUser(null);setToken(null);localStorage.clear();}return/*#__PURE__*/_jsx(BrowserRouter,{children:/*#__PURE__*/_jsx(UserContext.Provider,{value:{currentUser:currentUser,setCurrentUser:setCurrentUser},children:/*#__PURE__*/_jsxs(\"div\",{className:\"App\",children:[/*#__PURE__*/_jsx(NavBar,{logout:logout}),/*#__PURE__*/_jsx(Routes,{signup:signup,login:login})]})})});}export default App;","map":{"version":3,"sources":["/Users/davidbroida/Desktop/MusicMatch2/frontend/src/App.js"],"names":["React","useState","useEffect","BrowserRouter","NavBar","Routes","useLocalStorage","MusicMatchApi","jwt_decode","UserContext","TOKEN_STORAGE_ID","App","token","setToken","currentUser","setCurrentUser","infoLoaded","setInfoLoaded","loadUserInfo","getCurrentUser","username","console","error","signup","signupData","success","succes","errors","login","loginData","logout","localStorage","clear"],"mappings":"kZAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CACA,OAASC,aAAT,KAA8B,kBAA9B,CACA,MAAOC,CAAAA,MAAP,KAAmB,qBAAnB,CACA,MAAOC,CAAAA,MAAP,KAAmB,qBAAnB,CACA,MAAO,sCAAP,CACA,MAAOC,CAAAA,eAAP,KAA4B,yBAA5B,CACA,MAAOC,CAAAA,aAAP,KAA0B,WAA1B,CACA,MAAOC,CAAAA,UAAP,KAAuB,YAAvB,CACA,MAAOC,CAAAA,WAAP,KAAwB,oBAAxB,CACA;AACA,MAAO,WAAP,C,wFAEA,MAAO,IAAMC,CAAAA,gBAAgB,CAAG,mBAAzB,CAEP,QAASC,CAAAA,GAAT,EAAe,CACb,qBAA0BL,eAAe,CAACI,gBAAD,CAAzC,sDAAOE,KAAP,sBAAcC,QAAd,sBACA,cAAoCZ,QAAQ,CAAC,IAAD,CAA5C,wCAAKa,WAAL,eAAkBC,cAAlB,eACA,eAAoCd,QAAQ,CAAC,IAAD,CAA5C,yCAAOe,UAAP,eAAmBC,aAAnB,eAGAf,SAAS,CAAC,QAASgB,CAAAA,YAAT,EAAwB,SACjBC,CAAAA,cADiB,oJAChC,6KACMP,KADN,sDAGyBJ,UAAU,CAACI,KAAD,CAHnC,CAGYQ,QAHZ,aAGYA,QAHZ,CAIMb,aAAa,CAACK,KAAd,CAAsBA,KAAtB,CAJN,sBAK8BL,CAAAA,aAAa,CAACY,cAAd,CAA6BC,QAA7B,CAL9B,QAKUN,YALV,eAMMC,cAAc,CAACD,YAAD,CAAd,CANN,iFASMO,OAAO,CAACC,KAAR,CAAc,mEAAd,cACAP,cAAc,CAAC,IAAD,CAAd,CAVN,QAaEE,aAAa,CAAC,IAAD,CAAb,CAbF,qEADgC,iDAiBhCA,aAAa,CAAC,KAAD,CAAb,CACAE,cAAc,GACf,CAnBQ,CAmBN,CAACP,KAAD,CAnBM,CAAT,CANa,QA2BEW,CAAAA,MA3BF,8HA2Bb,kBAAsBC,UAAtB,yKAEsBjB,CAAAA,aAAa,CAACgB,MAAd,CAAqBC,UAArB,CAFtB,QAEQZ,MAFR,gBAGIC,QAAQ,CAACD,MAAD,CAAR,CAHJ,iCAIW,CAAEa,OAAO,CAAE,IAAX,CAJX,6DAMIJ,OAAO,CAACC,KAAR,CAAc,eAAd,eANJ,iCAOW,CAAEI,MAAM,CAAE,KAAV,CAAiBC,MAAM,aAAvB,CAPX,wEA3Ba,iDAsCEC,CAAAA,KAtCF,4HAsCb,kBAAqBC,SAArB,0KAEsBtB,CAAAA,aAAa,CAACqB,KAAd,CAAoBC,SAApB,CAFtB,QAEQjB,OAFR,gBAGIC,QAAQ,CAACD,OAAD,CAAR,CAHJ,iCAIW,CAAEa,OAAO,CAAE,IAAX,CAJX,6DAMIJ,OAAO,CAACC,KAAR,CAAc,cAAd,eANJ,iCAOW,CAAEG,OAAO,CAAE,KAAX,CAAkBE,MAAM,aAAxB,CAPX,wEAtCa,wCAiDb,QAASG,CAAAA,MAAT,EAAkB,CAChBf,cAAc,CAAC,IAAD,CAAd,CACAF,QAAQ,CAAC,IAAD,CAAR,CACAkB,YAAY,CAACC,KAAb,GACD,CAED,mBACE,KAAC,aAAD,wBACE,KAAC,WAAD,CAAa,QAAb,EAAsB,KAAK,CAAE,CAAElB,WAAW,CAAXA,WAAF,CAAeC,cAAc,CAAdA,cAAf,CAA7B,uBACE,aAAK,SAAS,CAAC,KAAf,wBACE,KAAC,MAAD,EAAQ,MAAM,CAAEe,MAAhB,EADF,cAEE,KAAC,MAAD,EAAQ,MAAM,CAAEP,MAAhB,CAAwB,KAAK,CAAEK,KAA/B,EAFF,GADF,EADF,EADF,CAUD,CAED,cAAejB,CAAAA,GAAf","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { BrowserRouter } from 'react-router-dom';\nimport NavBar from './components/NavBar';\nimport Routes from './components/Routes';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport useLocalStorage from './hooks/useLocalStorage';\nimport MusicMatchApi from './api/api';\nimport jwt_decode from 'jwt-decode';\nimport UserContext from './auth/UserContext';\n// import jwt from 'jsonwebtoken';\nimport './App.css';\n\nexport const TOKEN_STORAGE_ID = \"music_match-token\";\n\nfunction App() {\n  const [token, setToken] = useLocalStorage(TOKEN_STORAGE_ID);\n  let [currentUser, setCurrentUser] = useState(null);\n  const [infoLoaded, setInfoLoaded] = useState(true);\n\n\n  useEffect(function loadUserInfo() {\n    async function getCurrentUser() {\n      if (token) {\n        try {\n          let { username } = jwt_decode(token);\n          MusicMatchApi.token = token;\n          let currentUser = await MusicMatchApi.getCurrentUser(username);\n          setCurrentUser(currentUser);\n\n        } catch (err) {\n          console.error('App function loadUserInfo encountered a problem loading the user.', err);\n          setCurrentUser(null);\n        }\n      }\n      setInfoLoaded(true);\n    }\n\n    setInfoLoaded(false);\n    getCurrentUser();\n  }, [token]);\n\n  async function signup(signupData) {\n    try {\n      let token = await MusicMatchApi.signup(signupData);\n      setToken(token);\n      return { success: true };\n    } catch (errors) {\n      console.error('signup failed', errors);\n      return { succes: false, errors };\n    }\n  }\n\n  async function login(loginData) {\n    try {\n      let token = await MusicMatchApi.login(loginData);\n      setToken(token);\n      return { success: true };\n    } catch (errors) {\n      console.error('login failed', errors);\n      return { success: false, errors };\n    }\n  }\n\n  function logout() {\n    setCurrentUser(null);\n    setToken(null);\n    localStorage.clear()\n  }\n\n  return (\n    <BrowserRouter>\n      <UserContext.Provider value={{ currentUser, setCurrentUser }}>\n        <div className=\"App\">\n          <NavBar logout={logout} />\n          <Routes signup={signup} login={login} />\n        </div>\n      </UserContext.Provider>\n    </BrowserRouter>\n  );\n}\n\nexport default App;\n"]},"metadata":{},"sourceType":"module"}